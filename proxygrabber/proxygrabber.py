#!/bin/python3 

import requests
import json
import os
import time
from selenium import webdriver 
from selenium.webdriver import Chrome
from selenium.webdriver import ChromeOptions
from selenium.webdriver.common.by import By
from selenium.webdriver.common.keys import Keys
from selenium.webdriver.support.ui import Select
from selenium.common.exceptions import NoSuchElementException


def geonode():
	url = "https://proxylist.geonode.com/api/proxy-list?limit=500&page=2&sort_by=lastChecked&sort_type=desc"
	req = requests.get(url)
	res = req.text
	json_parse = json.loads(res)

	total = len(json_parse["data"])
	count = 0
	#print("Protocal\tIp address\tport")
	while count < total:
		ip = json_parse["data"][count]['ip']
		port = json_parse["data"][count]['port']
		protocal = json_parse["data"][count]['protocols'][0]
		#print(f"{protocal}\t{ip}\t{port}")
		file = open("proxychains4.conf", 'a')
		file.write('\n')
		file.write(f"{protocal}\t{ip}\t{port}")
		file.close
		count = count + 1

def spys():
	opt = webdriver.ChromeOptions()
	opt.add_extension('./CJPALHDLNBPAFIAMEJDNHCPHJBKEIAGM_1_59_0_0.crx')
	driver = webdriver.Chrome(options=opt)
	driver.get("https://spys.one/en/socks-proxy-list/")
	time.sleep(15)
	"""try:
		count = 1
		while True:
			addrport = driver.find_element(By.XPATH, f"/html/body/table[2]/tbody/tr[4]/td/table/tbody/tr[2]/td[{count}]/font").text
			#print(addrport)
			count = count + 1
	except NoSuchElementException as e:
		print(e)"""
	#print("Selecting value ....")
	select = Select(driver.find_element(By.ID, 'xpp'))
	select.select_by_value('5')
	time.sleep(5)
	try:
		k = 3
		m = 0
		while True:
			addr = driver.find_element(By.XPATH, f"/html/body/table[2]/tbody/tr[4]/td/table/tbody/tr[{k}]/td[1]/font").text
			addr = addr.split(':')
			ip = addr[0]
			port = addr[1]
			protocal = driver.find_element(By.XPATH, f"/html/body/table[2]/tbody/tr[4]/td/table/tbody/tr[3]/td[2]").text
			protocal = protocal.lower()
			print(f"{protocal}\t{ip}\t{port}")
			k = k + 1
			m = m + 1
			#write to proxychains conf
			file = open("proxychains4.conf", 'a')
			file.write('\n')
			file.write(f'{protocal}\t{ip}\t{port}')
	except NoSuchElementException as e:
		pass
	#print(m)
spys()